# Malware Analysis With X-Ways WinHex

Malicious software, abbreviated as "malware," is a broad term that refers to any harmful software program designed by cybercriminals to compromise the security and functionality of computer systems. As cyberattacks become more frequent, a growing number of individuals and organizations are falling victim to malware attacks, making malware analysis a critical part of modern cybersecurity efforts. Through malware analysis, we aim to gain a deeper understanding of how malicious software operates and the potential damage it can inflict. Malware comes in various forms, such as viruses, worms, and Trojan horses, and is used to secretly collect information from the infected machine without the user’s consent.

### Objective

To conduct a comprehensive malware analysis of the Pony malware on a Windows system. Pony, often referred to as Pony Stealer, Pony Loader, or FareIT, is a highly dangerous password-stealing malware capable of decrypting and collecting credentials from over 110 different applications.

### Prerequisites for Malware Analysis

Before proceeding with malware analysis, ensure you have the following:

1. **Pony Malware Sample**: Obtain a sample of the Pony malware from [Any.Run Malware Trends](https://any.run/malware-trends/pony).
2. **Extract the File**: Use a password-protected ZIP archive to safely extract the Pony malware sample. This prevents accidental execution of the malware.
3. **Necessary Tools for Analysis**: Download and install the following tools to aid in analyzing the malware:
   - **X-Ways WinHex (Hex Editor)**: [Download here](https://x-ways.net/winhex/index-m.html)
   - **Exeinfo PE (PE file identification program)**: [Download here](https://exeinfo-pe.en.uptodown.com/windows)
   - **PeStudio (Malware Initial Assessment Tool)**: [Download here](https://www.winitor.com/)

### Safety Guidelines for Malware Analysis

When analyzing malware, especially a dangerous sample like Pony, it’s crucial to follow strict safety procedures:

- **Use a Virtual Machine (VM)**: Always conduct malware analysis within a virtual environment. Ensure the VM is isolated from your host machine by using a host-only network configuration.
- **Disable Shared Folders**: Make sure no folders are shared between the VM and host machine to prevent accidental transfer of malware.
- **Avoid USB Drives**: Do not connect any USB devices to the VM, as they could become infected.
- **Ensure Proper Containment**: Keep your VM updated, and only handle compressed, password-protected malware samples to minimize the risk of accidental execution or spread.

---

### Step-by-Step Malware Analysis Procedure

Understanding how a piece of malware is structured can help cybersecurity professionals quickly identify its purpose and potential impact. A key step in malware analysis is determining the file type of the suspicious binary. For example, if it’s identified as a Portable Executable (PE) file, it’s likely intended to target Windows systems. Identifying the file type helps narrow down the types of systems and operations the malware is designed to affect.

#### **Hex Editors: Identifying File Type with WinHex**

Hex editors like **WinHex** are among the most basic yet powerful tools for malware analysis. These editors allow you to view and modify the raw hexadecimal content of a file, offering insights into its structure.

**Steps for Using WinHex Hex Editor:**
1. Open the Pony malware sample in **WinHex**.
2. Look for the file signature **"4D 5A"** at the first offset (00 and 01 bytes). This signature indicates that the file is a **Portable Executable (PE)**, typically an .exe or .dll file, which is common for malware targeting Windows systems.
3. In the decoded text area, locate the phrase **"This program cannot be run in DOS mode"**. This message confirms that the file is indeed a PE and is designed to run on modern Windows systems.

<img src="https://github.com/Hashdan-M/Malware-Analysis-With-X-Ways-WinHex/blob/900c783225b7832c540cc93a9b3704dd227c139b/WinHex/2-1.PNG"/></a>

---

#### **Exeinfo PE: Detecting Obfuscation and Analyzing PE Structure**

Cybercriminals often use obfuscation techniques to conceal the inner workings of malware and evade detection by security researchers. Tools like **Exeinfo PE** are essential for identifying such obfuscation or determining the properties of an executable file.

**Steps for Using Exeinfo PE:**
1. Open the Pony malware sample in **Exeinfo PE**. Among the info available are the **Entry point**, **Linker information** and **Overlay information**.

<img src="https://github.com/Hashdan-M/Malware-Analysis-With-X-Ways-WinHex/blob/900c783225b7832c540cc93a9b3704dd227c139b/WinHex/2-2.PNG"/></a>

2. If no packing information is displayed, it means the malware hasn’t been packed, indicating that no specific measures were taken by the attacker to hide the malware through compression or obfuscation. Go to the **Sections viewer** where users can see every virtual offset and size, flags, name, RAW data offset and size, first bytes and section status.

<img src="https://github.com/Hashdan-M/Malware-Analysis-With-X-Ways-WinHex/blob/900c783225b7832c540cc93a9b3704dd227c139b/WinHex/2-3.PNG"/></a>
   
3. Go to the **PE Header** to view the Header Info. Check for any import and export information, showing which external libraries (DLLs) and functions the malware relies on. This can offer clues about its behavior.

<img src="https://github.com/Hashdan-M/Malware-Analysis-With-X-Ways-WinHex/blob/900c783225b7832c540cc93a9b3704dd227c139b/WinHex/2-4.PNG"/></a>

---

#### **PeStudio: Static Malware Analysis for Quick Assessment**

**PeStudio** is a static analysis tool used to quickly identify suspicious artifacts within executable files, facilitating the initial assessment of malware without actually executing it.

**Steps for Using PeStudio:**
1. Open the Pony malware in **PeStudio**. The tool will immediately display basic information about the malware, such as file size, hash value, file format, and other metadata.

<img src="https://github.com/Hashdan-M/Malware-Analysis-With-X-Ways-WinHex/blob/3d6c74e5a5a461c631c6fd32e8563fce1191104e/WinHex/2-5.PNG"/></a>

2. Navigate through the **indicators** section, which highlights any references to flagged objects or URLs. This section can reveal whether the malware is attempting to exfiltrate data over the internet.

<img src="https://github.com/Hashdan-M/Malware-Analysis-With-X-Ways-WinHex/blob/3d6c74e5a5a461c631c6fd32e8563fce1191104e/WinHex/2-6.PNG"/></a>

3. Explore the **strings** section, which contains a list of all text strings within the malware. Look for suspicious elements like file names, URLs, IP addresses, and registry keys, which might provide insights into the malware’s functionality and communication channels.

<img src="https://github.com/Hashdan-M/Malware-Analysis-With-X-Ways-WinHex/blob/3d6c74e5a5a461c631c6fd32e8563fce1191104e/WinHex/2-7.PNG"/></a>

4. In the **libraries** section, PeStudio displays the list of required DLLs and flags any suspicious or blacklisted libraries. This can help determine if the malware is leveraging known malicious libraries.

<img src="https://github.com/Hashdan-M/Malware-Analysis-With-X-Ways-WinHex/blob/3d6c74e5a5a461c631c6fd32e8563fce1191104e/WinHex/2-8.PNG"/></a>

7. Examine the **imports** section to identify functions the malware calls upon, potentially revealing its intended operations (such as stealing credentials or modifying system settings).

<img src="https://github.com/Hashdan-M/Malware-Analysis-With-X-Ways-WinHex/blob/3d6c74e5a5a461c631c6fd32e8563fce1191104e/WinHex/2-9.PNG"/></a>

---

### Final Identification of Malware Using Hashes

For a more accurate and reliable identification of malware, it’s recommended to use file hashes instead of relying on filenames, which can easily be altered. Tools like [VirusTotal](https://www.virustotal.com/gui/) allow analysts to submit malware hashes to check if the sample has been flagged as malicious by other security vendors.

**Steps for Using VirusTotal**:
1. Obtain the hash of the Pony malware sample.
2. Enter the hash into VirusTotal’s search bar.
3. Review the scan results.

<img src="https://github.com/Hashdan-M/Malware-Analysis-With-X-Ways-WinHex/blob/ec5f7d18acb92335a4d5fb2809a19e43d2790105/WinHex/2-10.PNG"/></a>

4. Tthe file is marked malicious by 66 out of 72 antivirus engines, it’s highly likely to be malware.

---

### Conclusion
By following this process, a thorough understanding of the Pony malware’s characteristics, capabilities, and potential threats can be achieved. This methodical approach to malware analysis ensures that security researchers can detect, identify, and mitigate the impact of malicious software in a controlled and secure environment.

